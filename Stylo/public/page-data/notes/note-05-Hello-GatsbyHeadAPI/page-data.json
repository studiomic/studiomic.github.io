{"componentChunkName":"component---src-templates-note-post-js","path":"/notes/note-05-Hello-GatsbyHeadAPI/","result":{"data":{"markdownRemark":{"id":"d0fb4358-8c17-5e00-be2c-f4f7db6808a0","html":"<section style=\"margin-bottom: 6em;\">\n<details>\n  <summary>もくじ</summary>\n<ul>\n<li><a href=\"#src\">チュートリアルと参考サイト・ソース</a></li>\n<li><a href=\"#title\">&#x3C;title>タグを繋げる（React-Helmet）</a></li>\n<li><a href=\"#title-API\">Gatsby Head APIでtitleを繋ぐ</a></li>\n<li><a href=\"#page-template\">固定ページとテンプレート</a></li>\n<li><a href=\"#metadata\">metadataの書き方</a></li>\n<li><a href=\"#seo-js\">Gatsby Head API版 Seoコンポーネント</a></li>\n<li><a href=\"#lang\">lang属性は、gatsby-ssr.jsへ</a></li>\n<li><a href=\"#index-js\">index.js</a></li>\n<li><a href=\"#ternary-operator\">三項演算子を見直してなおす</a></li>\n<li><a href=\"#nice\">Gatsby Head API いいですね！</a></li>\n</ul>\n</details>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<p>このブログサイトを公開する前からGatsby.jsを触りはじめていたとはいえ、最初からv5で、多分早いうちに\n<a href=\"https://www.gatsbyjs.com/plugins/gatsby-plugin-react-helmet/?=he\">gatsby-plugin-react-helmet</a>が非推奨だと知った。</p>\n<p>かといって、開発環境で興に乗って楽しんでいるときに、大急ぎで対応する気はなかったのだが。<br>\nGit branchを3つ使い分けていて・・というかmainと開発環境と2つ使い分けていて、途中で1つ永久保存版に封印したbranchがあった。</p>\n<p>その封印ブランチで、<code class=\"language-text\">&lt;html lang=\"ja\"></code> となおしていたのをmainに反映し忘れていて、後日、<code class=\"language-text\">&lt;html lang=\"en\"></code> が残っているのに気づき、「カッときてやりました」😆</p>\n<p>自分のミスなのにw なんじゃこりゃ〜と松田優作になって、Headごと挿げ替えることに。<br>\nどちらかというと「なんだとー！」の発音で「enだとー！」と苦笑した勢いだけでスタート。</p>\n<p>咄嗟の思い立ちでいくつかのサイトを参考にさせていただきました。<br></p>\n<p><a name=\"src\"></a></p>\n<p>列挙：</p>\n<blockquote>\n<p><a href=\"https://www.ultra-noob.com/blog/2022/47/\">gatsby-plugin-react-helmetが廃止予定に！ヘッダはAPIを使おう【Gatsby.js】 | 謎の技術研究部</a></p>\n<p><a href=\"https://bel-itigo.com/how-to-use-gatsby-head-api/\">非推奨になるreact-helmetからGatsby Head APIに書き換える方法 | ベル15の開発ブログ</a></p>\n</blockquote>\n<p>Gatsby Docs：</p>\n<blockquote>\n<p><a href=\"https://www.gatsbyjs.com/docs/reference/built-in-components/gatsby-head/\">Gatsby Head API | Gatsby</a></p>\n<p><a href=\"https://www.gatsbyjs.com/docs/how-to/adding-common-features/adding-seo-component/#prerequisites\">Adding an SEO Component | Gatsby</a></p>\n</blockquote>\n<p>そして何よりも、人気starterのsource（gatsby-starter-blog）</p>\n<blockquote>\n<p><a href=\"https://github.com/gatsbyjs/gatsby-starter-blog/blob/master/src/components/seo.js\">gatsby-starter-blog/src/components/seo.js at master · gatsbyjs/gatsby-starter-blog\n· GitHub</a></p>\n</blockquote>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<p>このサイトで使っているスターターは<a href=\"https://github.com/contentful/starter-gatsby-blog/blob/master/src/components/seo.js\">Contentful / starter-gatsby-blog</a> なのですが、リンクした\n<strong>components/seo.js</strong>　は、「gatsby-starter-blog」の<strong>components/seo.js</strong>　とそっくり。</p>\n<strong>\n前者はReact-helmet版で、後者はGatsby Head API版<br>\n</strong>\n<hr>\n<p>さすがの人気スターターでGatsby, Inc.提供だから、すでにHead API対応済みで参考になるどころじゃない。</p>\n<p>そのまま写経で通用するくらい、変数名や手法も同じなので、GitHubでページごとのソースを確認しながら自分のサイトに適用していきました。</p>\n<hr>\n<p><a name=\"title\"></a></p>\n<p>今後、Gatsby Head APIへ移行する方の参考になりそうな要点を書き出してみます。</p>\n<p>まず大事な <code class=\"language-text\">&lt;title>Document&lt;/title></code> 部分。</p>\n<p>実際は　-　Pageタイトル　｜　Siteタイトル　- とパイプなどで繋いで2つの値を入れる要素。</p>\n<p>固定ページなら <code class=\"language-text\">　About | Stylo de Cerise　</code><br>\nブログのPostページなど、テンプレートから動的につくられるページなら　<code class=\"language-text\">　記事タイトル | Stylo de Cerise　</code>　のようにブラウザで表示されるドキュメント・タイトル。</p>\n<p>旧react-helmet版では</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>components/seo.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span>\ndefaultTitle<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>defaultTitle<span class=\"token punctuation\">}</span>\ntitleTemplate<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>defaultTitle <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">%s | </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>defaultTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>title= でページのタイトルを取得し<br>\ndefaultTitle= にgatsby-config.jsで記載済みのsiteMetadata.titleを代入<br>\ntitleTemplate= でdefaultTitleを文字列 | パイプ付に整形し<br></p>\n<p><strong>title</strong> と\n<strong>titleTemplate</strong> がtitle:タグに置かれている模様。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>{title}{titleTemplate}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>SEOコンポーネント全体では、27-29行のところ</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>components/seo.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Helmet <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-helmet'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useStaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span>\n\n<span class=\"token keyword\">const</span> Seo <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> description <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> lang <span class=\"token operator\">=</span> <span class=\"token string\">'ja'</span><span class=\"token punctuation\">,</span> meta <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> image <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> site <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>\n    graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      query {\n        site {\n          siteMetadata {\n            title\n            description\n          }\n        }\n      }\n    </span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> metaDescription <span class=\"token operator\">=</span> description <span class=\"token operator\">||</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>description\n  <span class=\"token keyword\">const</span> defaultTitle <span class=\"token operator\">=</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token operator\">?.</span>title\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Helmet\n      htmlAttributes<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        lang<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span>\n      defaultTitle<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>defaultTitle<span class=\"token punctuation\">}</span>\n      titleTemplate<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>defaultTitle <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">%s | </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>defaultTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span>\n      meta<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">description</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> metaDescription<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">image</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> image<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">property</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">og:title</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> title<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">property</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">og:description</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> metaDescription<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">property</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">og:type</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">website</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">property</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">og:image</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> image<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">twitter:card</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">summary_large_image</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">twitter:creator</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token operator\">?.</span>social<span class=\"token operator\">?.</span>twitter <span class=\"token operator\">||</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">twitter:title</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> title<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">twitter:description</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> metaDescription<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>meta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Seo</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<h2>Gatsby Head APIでtitleを繋ぐ <a name=\"title-API\"></a></h2>\n\n        <div class=\"gatsby-code-title\">\n          <span>components/seo.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> metaDescription <span class=\"token operator\">=</span> description <span class=\"token operator\">||</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>description\n<span class=\"token keyword\">const</span> defaultTitle <span class=\"token operator\">=</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token operator\">?.</span>title\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>defaultTitle <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> | </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>defaultTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n\n<span class=\"token operator\">...</span>略</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同じ変数名defaultTitleへ\nsiteMetadata.titleを代入したあと6行目で、Helmet版と<span class=\"crimson-col bold\">似たような</span>置き換えをしています。</p>\n<p><strong>${title}</strong>　は、</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Seo</span> <span class=\"token attr-name\">title</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>About<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>といった書き方でSeoコンポーネントに渡していた値です。<br>\nページdescriptionや、BlogPost「Hero Image」をimage=で渡しているケースが多いかと思います。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Seo</span>\n\t<span class=\"token attr-name\">title</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{post.title}</span>\n\t<span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{plainTextDescription}</span>\n\t<span class=\"token attr-name\">image</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{`http:${post.heroImage.resize.src}`}</span>\n<span class=\"token punctuation\">/></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上の例は、BlogPostテンプレートで<br>\n&#x3C;Layout ・・・の直下に書いていたものですが、Gatsby Head APIの場合は、</p>\n<p><strong>export const Head =</strong> でHTML <code class=\"language-text\">&lt;head></code> に直接書きだす形になります。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>templates/blog-post.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Head</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">contentfulBlogPost</span><span class=\"token operator\">:</span> post <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> plainTextDescription <span class=\"token operator\">=</span> <span class=\"token function\">documentToPlainTextString</span><span class=\"token punctuation\">(</span>\n    <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">.</span>raw<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Seo\n      title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span>\n      description<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>plainTextDescription<span class=\"token punctuation\">}</span>\n      image<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">http:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>post<span class=\"token punctuation\">.</span>heroImage<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">.</span>src<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>挿入箇所は<a href=\"https://github.com/gatsbyjs/gatsby-starter-blog/blob/master/src/templates/blog-post.js\">実際のソースを見た方が早い</a>ですが</p>\n<p>export default BlogPostTemplate の直前に配置してあった・・・。</p>\n<p>うちは export default BlogPostTemplate 直後、GraphQL前に置いたり、ページ末に置いたり、ページによってまちまちと雑なことしてた。（あとで揃えよう💧）</p>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<h2>固定ページとテンプレート <a name=\"page-template\"></a></h2>\n<p>もともとtwitter:cardやら、SEO方面は何もしてないので、Seoコンポーネントの使用はごく典型的な例が多いです。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>固定ページ：タイトルのみ</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Head</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>Seo title<span class=\"token operator\">=</span><span class=\"token string\">\"Blog\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>という最小例から、Markdown用テンプレートや</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>templates/note-post.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Head</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">markdownRemark</span><span class=\"token operator\">:</span> post <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Seo\n      title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span>\n      description<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>description <span class=\"token operator\">||</span> post<span class=\"token punctuation\">.</span>excerpt<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>タグ一覧のテンプレートでは、pageContextで渡されたTagの表示名「Gatsby.js」などをtitleに入れるようにしたり。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>templates/tag-index.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Head</span> <span class=\"token operator\">=</span>  <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> pageContext <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> names <span class=\"token operator\">=</span> <span class=\"token string\">'Tags:'</span> <span class=\"token operator\">+</span> pageContext<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Seo\n      title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>names<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n\n        <div class=\"gatsby-code-title\">\n          <span>OUTPUT</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Tags:Gatsby.js | SiteTitle<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<h2>metadataの書き方 <a name=\"metadata\"></a></h2>\n\n        <div class=\"gatsby-code-title\">\n          <span>react-helmet:seo.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">meta<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">description</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> metaDescription<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span>略<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>meta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>React-helmetプラグイン版で、ずらりと配列されていた部分。</p>\n<p>HTML <code class=\"language-text\">&lt;head></code> に何を書くか、なので古式ゆかしくmetaタグ書きをしていく中に、適宜変数を与える感じです。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{metaDescription}</span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>og:title<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{title}</span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>og:description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{metaDescription}</span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>og:type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>website<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>これも「gatsby-starter-blog」からマルっとコピーしてきて、該当するHelmet側を1つずつ消していき・・・とやってみると、まったく同じ要素数だったので自分で書き足すこともなかったです。</p>\n<hr>\n<p>この複写時に、自分でHelmetをゴリゴリ書き換えていた人は、その設定を消してしまわないよう気をつければ良いのでしょう。</p>\n<p>意外にも\nog:typeなど、最初からwebsiteで固定値になってましたが、createPageから、テンプレートを使う際に\nwebsite / blog / article を分けて入れるなど、固定値・変数を使い分けて設定可能。</p>\n<p>うちの場合は、使っていないのをまとめてザクっと消したくらいで、妙に短くなったかも💧</p>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<h2>Gatsby Head API版の全体像は <a name=\"seo-js\"></a></h2>\n<p>タイトルとディスクリプション重視だなぁ・・・<br></p>\n<p>特記事項は、アンインストールしたHelmetをimportから外して4行目の<strong>const Seo =</strong> が変わった点。<br>\n23行目からのreturn ()には、\n<code class=\"language-text\">&lt;Helmet ..... /></code> の代わりに</p>\n<p><code class=\"language-text\">&lt;> ..... &lt;/></code>　Reactフラグメントで囲い<br>\n最後に変数受け取り用の <strong>{children}</strong> を4行目と合わせて追加。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>seo.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useStaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Seo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> description<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> site <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>\n    graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      query {\n        site {\n          siteMetadata {\n            title\n            description\n            siteUrl\n            developer\n          }\n        }\n      }\n    </span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> metaDescription <span class=\"token operator\">=</span> description <span class=\"token operator\">||</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>description\n  <span class=\"token keyword\">const</span> defaultTitle <span class=\"token operator\">=</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token operator\">?.</span>title\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>defaultTitle <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> | </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>defaultTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"description\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>metaDescription<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta property<span class=\"token operator\">=</span><span class=\"token string\">\"og:title\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta property<span class=\"token operator\">=</span><span class=\"token string\">\"og:description\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>metaDescription<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta property<span class=\"token operator\">=</span><span class=\"token string\">\"og:type\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"website\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"twitter:card\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"summary\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"twitter:creator\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token operator\">?.</span>social<span class=\"token operator\">?.</span>twitter <span class=\"token operator\">||</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"twitter:title\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"twitter:description\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>metaDescription<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Seo</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<p>meta={[ 配列 ]} だったのが直書きになったので、</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Seo <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> description <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> lang <span class=\"token operator\">=</span> <span class=\"token string\">'ja'</span><span class=\"token punctuation\">,</span> meta <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> image <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>↑から、↓になりました。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Seo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> description<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>😨 これだとBlogPostが渡した「heroImage」の収まり場がない。と今更気づいたけど、その訂正はさておき\n<a name=\"lang\"></a></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">lang <span class=\"token operator\">=</span> <span class=\"token string\">'jp'</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token operator\">&lt;</span>Helmet\n      htmlAttributes<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        lang<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>の行き場。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ja<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>HTML <code class=\"language-text\">&lt;head></code> 要素ではないlang属性は、サイトのルートに<a href=\"https://github.com/gatsbyjs/gatsby-starter-blog/blob/master/gatsby-ssr.js\">gatsby-ssr.js</a>ファイルを作成して、</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>gatsby-ssr.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token comment\">/**\n * Implement Gatsby's SSR (Server Side Rendering) APIs in this file.\n *\n * See: https://www.gatsbyjs.com/docs/reference/config-files/gatsby-ssr/\n */</span>\n\n<span class=\"token comment\">/**\n * @type {import('gatsby').GatsbySSR['onRenderBody']}\n */</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onRenderBody</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> setHtmlAttributes <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setHtmlAttributes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">lang</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">ja</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>と設定することで加筆できます。<a href=\"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-ssr/\">Gatsby Server Rendering APIs | Gatsby</a> を見てね！　と書いてあるので素直に開いて日本語表示をGoogleさんにお願いして、\n「gatsby-starter-blog」から模倣した振る舞いの理屈を復習します。</p>\n<hr>\n<p>いつもながら、Gatsbyのドキュメンテーションを見ると（なんでこんなに親切なの？！）と感心・・・をちょっと通り過ぎる、上回るものがあるんですが。</p>\n<p>今日わかった、今気づいた。</p>\n<p>この網羅感は <a href=\"https://developer.mozilla.org/ja/\">MDN Web Docs</a>\nを彷彿とする。</p>\n<p>そしてグレートなGatsbyはどちらの意味の命名なんだろう。<br>\n文学界では、ディケンズ「二都物語」と並んで思い出すような「献身」男の代名詞・・・。<br>\n<br></p>\n<p>ともかくも、そこへ行けばどうにかなる！ 絶対感が、（あぁMDNに似てたかぁ）とやっと自分の中で腑に落ちたところで。<br>\nこの人は、おもむろにiTune Storeを開き、松任谷由実「DESTINY」を購入しましたよね（笑</p>\n<p>ー「怖可愛いサンダルがどうとかいう曲」を歌ってくれヒロセちゃん！とカラオケボックスで宣っていた30代もわずかに成長はしている。たぶんおそらく。</p>\n<p>閑話休題ー<br></p>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<p>Gatsby公式サイトの献身性については機会があったら書くとして、最後にいちばんユニークな部分。<br>\nサイトルート、トップページ、について書いて終わります。</p>\n<h1>index.js <a name=\"index-js\"></a></h1>\n<p>まずすごく単純なところを見落として、最後に手間取った<strong>index.js</strong> 処理。<br></p>\n<p>保存版にしているbranchで古いファイルを見ても、特にSeoコンポーネントを呼び出しもせず、<br>\nでもgatsby-config.jsの module.exports = {\nsiteMetadata: {　の記載内容はしっかり反映されていました。</p>\n<p>そもそもReact Helmetプラグインをほぼ無意識に使っていただけなので、今更にサーバーレンダリングだ、Reactフックだと文字面だけ追って理解もなく。ただ何かうまいことやってくれてたんだろなと想像するのみ。</p>\n<p>で、途中一度、暴挙に出て。<br>\nただ単純に直に書くことにした。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>index.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Head</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>title<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"description\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>他のページ群で使いまわしているSeoコンポーネントを通すには、title=を渡さないと<br>\n<code class=\"language-text\">&lt;title>&lt;/title></code> タグを書いてもらえない。</p>\n<p>空白文字列を渡せばパイプはじまりで書かれる。<br>\n素直に title=\"Home\"と渡して <code class=\"language-text\">&lt;title>Home | SiteName&lt;/title></code> としたって間違いじゃないけど、懐かしのオーサリングソフトにでも書いてもらったか？！な味わい深い感じになる。</p>\n<p>まぁそのように書いているわけですからね、Seoコンポーネントで。<br>\nむしろ今になって考えると、ブラウザのデベロッパーツールまで使って、いろいろやってみたこの筆者こそ変。</p>\n<hr>\n<p>あれこれ書いちゃったあとで「gatsby-starter-blog」の方を再度、確認にいくと title= に\"All posts\"と渡してましたね・・・きゃー。オーサリングソフトノフカイアジワイとか失敬な！輩でごめんなさい。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>index.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Head</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>Seo title<span class=\"token operator\">=</span><span class=\"token string\">\"All posts\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>ま。スターターは学舎ですからね、卒業するまでは汎用性大事。</p>\n<p>「gatsby-starter-blog」の通りでいくと、何をやってもパイプが残り、\n直書きすると、Seoコンポーネントに書いた内容がルートページのHEADに載せられない😨本末転倒なことになるため、少し改変しました。</p>\n</section>\n<section style=\"margin-bottom: 6em;\">\n<h2>三項演算子を見直してなおす <a name=\"ternary-operator\"></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>defaultTitle <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> | </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>defaultTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><a href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Conditional_operator\">条件 (三項) 演算子 - JavaScript | MDN</a> を見ながら、\n似て非なるものを見比べた。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\">titleTemplate<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>defaultTitle <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">%s | </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>defaultTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<blockquote>\n条件に続いて疑問符 (?)、そして条件が真値であった場合に実行する式、コロン (:) が続き、条件が偽値であった場合に実行する式が最後に来ます。\n</blockquote>\n<p>下の、React-helmet向けだった方は\ndefaultTitleが真値であるため | パイプを前に置く整形をしてたわけで、\nsiteMetadata.titleを間違って消したりすれば偽値となって、nullが返る。</p>\n<p>上は、defaultTitleが真値なら、{title} と {defaultTitle} の間に | パイプを挿んで整形してね<br>\ndefaultTitleが偽値なら、titleを返せば良いよ。<br>\nこれはもぅ、siteMetadata.titleを故意に消さないかぎり | パイプから逃れられない式なので、書き換え。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>title <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> | </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>defaultTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> defaultTitle<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>titleが真値なら、title｜defaultTitle　になり<br>\ntitleが偽値なら、defaultTitle　が返る。</p>\n<p>つまりページタイトルを設定する気のないサイトルート、index.js は、defaultTitle=siteMetadata.title が表示される。</p>\n<p>あー長かった。</p>\n<p>それに合わせて、seo.js の冒頭<strong>title,</strong> を空でもいいよーに変更して終わり。</p>\n\n        <div class=\"gatsby-code-title\">\n          <span>components/seo.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> Seo <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> description<span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<hr>\nあ。肝心なindex.jsはtitle以外の何かを渡さねばSeoコンポーネントを使えないので、姑息にdescriptionを渡しました。\n\n        <div class=\"gatsby-code-title\">\n          <span>components/seo.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Head</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Seo</span></span>\n      <span class=\"token attr-name\">description</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span></span>\n    <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</section>\n<section style=\"margin-bottom: 1em;\">\n<h2>Gatsby Head API いいですね！⭐️⭐️⭐️⭐️⭐️<a name=\"nice\"></a></h2>\n<p>先に書いちゃうと、Lighthouseスコアは、React-helmet も Gatsby Head API も 現状では同じでした。<br>\n特にSEO部分は注力してないままの数値、内容は前に同じでトレースしただけなのでこれは当然。</p>\n<p>非推奨になったから、やむなく移行、しかも主要プラグインをアンインストールしてからの「大工事」みたいに想定してましたが、まーほんとヘルメット脱いでさっぱりしたわぁ、くらいの軽い作業で\nHTML<code class=\"language-text\">&lt;head></code> に直接アクセスできるようになったというのは、考えたら、たまらん恩賜公園なみの解放感。</p>\n<p>同じReactでも、先日まで触ってたWordPressでは「functions.php」しかほぼ窓口がない。<br>\nそこしかないから、そこを読めばだいたい載ってる・・・てのも、慣れれば都、かもしれないが、再び棲みたいと思えないのもね、うーん。なんだかとても勿体無い。</p>\n<p>「Gutenbergはとても魅力的な女の子。だけどあの娘の親がちょっとアレで、特にグランパのPHPが・・・」的な話は詮無いのでやめよう。（Gutenbergは元男の子だけどさ）</p>\n<hr>\n<p>React-helmet、素晴らしいネーミングセンスだと思ってましたが、最短でのお別れになりました。</p>\n</section>\n<!-- EOF -->","timeToRead":11,"frontmatter":{"title":"React-helmetを脱いでGatsby Head APIを冠る","date":"2023/06/17","description":"Bye, React-helmet to Gatsby Head API","slug":"note-05-Hello-GatsbyHeadAPI","featuredImage":null}}},"pageContext":{"slug":"note-05-Hello-GatsbyHeadAPI","previous":"note-07-darkMode-ternaryOperator","next":"note-05-page-nav","previousTitle":"部屋とTシャツとダークモードと三項演算子","nextTitle":"BlogのPrev-Nextナビゲーションを直すついでに","id":"d0fb4358-8c17-5e00-be2c-f4f7db6808a0"}},"staticQueryHashes":["2507079572"],"slicesMap":{}}